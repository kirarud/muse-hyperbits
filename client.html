<!-- client.html -->
<!DOCTYPE html>
<html>
<head>
  <title>–ú—É–∑–∞ ‚Äî MVP</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; }
    input, textarea, select { width: 100%; padding: 0.5rem; margin: 0.5rem 0; }
    button { background: #3a86ff; color: white; border: none; padding: 0.5rem 1rem; cursor: pointer; }
    #log { background: #f0f0f0; padding: 1rem; height: 200px; overflow-y: auto; }
  </style>
</head>
<body>
  <h1>–ú—É–∑–∞ ‚Äî –û–±–º–µ–Ω –≥–∏–ø–µ—Ä–±–∏—Ç–∞–º–∏</h1>
  <input id="name" placeholder="–í–∞—à–µ –∏–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" />
  <textarea id="content" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"></textarea>
  <select id="base">
    <option value="idea">–ò–¥–µ—è</option>
    <option value="question">–í–æ–ø—Ä–æ—Å</option>
    <option value="task">–ó–∞–¥–∞—á–∞</option>
    <option value="note">–ó–∞–º–µ—Ç–∫–∞</option>
    <option value="emotion">–≠–º–æ—Ü–∏—è</option>
  </select>
  <input type="range" id="energy" min="1" max="10" value="5" />
  <span id="energy-value">5</span>
  <input type="color" id="color" value="#3a86ff" />
  <button onclick="send()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  <div id="log"></div>

  <script>
    const log = document.getElementById('log');
    const energySlider = document.getElementById('energy');
    const energyValue = document.getElementById('energy-value');
    energySlider.oninput = () => energyValue.textContent = energySlider.value;

    const ws = new WebSocket('ws://localhost:8080');
    ws.onopen = () => log.innerHTML += '<div>üü¢ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É</div>';
    ws.onmessage = (event) => {
      const msg = JSON.parse(event.data);
      if (msg.error) {
        log.innerHTML += `<div style="color:red">‚ùå ${msg.error}</div>`;
      } else {
        const style = `background:${msg.hyperbits.color}; padding:0.3rem; margin:0.3rem 0; border-radius:4px;`;
        log.innerHTML += `<div style="${style}"><strong>[${msg.hyperbits.base}]</strong> ${msg.payload.content} (${msg.sender.name || msg.sender.id})</div>`;
      }
      log.scrollTop = log.scrollHeight;
    };

    function send() {
      const message = {
        meta: {
          version: "muse-mvp-1.0",
          timestamp: new Date().toISOString()
        },
        hyperbits: {
          base: document.getElementById('base').value,
          energy: parseInt(document.getElementById('energy').value),
          color: document.getElementById('color').value
        },
        payload: {
          type: "text",
          content: document.getElementById('content').value
        },
        sender: {
          id: 'user_' + Math.random().toString(36).substr(2, 9),
          name: document.getElementById('name').value || undefined
        }
      };
      ws.send(JSON.stringify(message));
      document.getElementById('content').value = '';
    }
  </script>
</body>
</html>
